---
import { twMerge } from 'tailwind-merge';
import { type ProjectCardProps as ProjectData } from './ProjectCard.astro';
import ProjectCard from './ProjectCard.astro';

interface Props {
  class?: string;
  data?: Array<ProjectData>;
  layout?: {
    columns: number;
    rows: number;
    spans?: Array<{ col?: number; row?: number }>;
  };
}

const { class: className = '', data = [], layout } = Astro.props as Props;

// Convert layout config to Tailwind classes
const getGridClass = () => {
  // Default responsive grid when no explicit layout provided:
  // mobile: 1 col, sm: 2 cols, md: 3 cols
  if (!layout) return 'grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3';

  const colsMap: Record<number, string> = {
    1: 'grid-cols-1',
    2: 'grid-cols-2',
    3: 'grid-cols-3',
    4: 'grid-cols-4',
    6: 'grid-cols-6',
    12: 'grid-cols-12',
  };

  const rowsMap: Record<number, string> = {
    1: 'grid-rows-1',
    2: 'grid-rows-2',
    3: 'grid-rows-3',
    4: 'grid-rows-4',
    6: 'grid-rows-6',
  };

  // Use a responsive approach: base 1 col, sm 2 cols, md use the requested layout.columns
  const mdCols = colsMap[layout.columns] || 'grid-cols-1';
  return `grid gap-4 grid-cols-1 sm:grid-cols-2 md:${mdCols} ${rowsMap[layout.rows] || ''}`;
};

const getSpanClass = (span?: { col?: number; row?: number }) => {
  if (!span) return '';

  const colSpanMap: Record<number, string> = {
    1: 'col-span-1',
    2: 'col-span-2',
    3: 'col-span-3',
    4: 'col-span-4',
    6: 'col-span-6',
    12: 'col-span-12',
  };

  const rowSpanMap: Record<number, string> = {
    1: 'row-span-1',
    2: 'row-span-2',
    3: 'row-span-3',
    4: 'row-span-4',
    6: 'row-span-6',
  };

  const classes = [span.col ? colSpanMap[span.col] || '' : '', span.row ? rowSpanMap[span.row] || '' : ''].filter(
    Boolean
  );

  return classes.join(' ');
};

const gridClass = getGridClass();
---

<ul class={twMerge(gridClass, className)}>
  {
    data.map((item, index) => {
      const span = layout?.spans?.[index];
      const spanClass = getSpanClass(span);

      return (
        <li class={twMerge('w-full', spanClass)}>
          <ProjectCard
            id={item.id}
            href={item.href}
            imageSrc={item.imageSrc}
            title={item.title}
            excerpt={item.excerpt}
          />
        </li>
      );
    })
  }
</ul>
